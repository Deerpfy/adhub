<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#14b8a6">
    <meta name="description" content="DocBook - 100% offline dokumentacni platforma. Vytvarejte, organizujte a exportujte dokumentaci bez internetu.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DocBook">

    <title>DocBook - Offline Documentation</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">

    <link rel="stylesheet" href="styles.css?v=1.0.0">

    <!-- Dexie.js - IndexedDB wrapper (MIT license) -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
    <!-- Marked.js - Markdown parser (MIT license) -->
    <script src="https://unpkg.com/marked@11.1.1/marked.min.js"></script>
    <!-- DOMPurify - XSS sanitizer (Apache 2.0 / MIT dual license) -->
    <script src="https://unpkg.com/dompurify@3.0.6/dist/purify.min.js"></script>
    <!-- FlexSearch - Fast fulltext search (Apache 2.0 license) -->
    <script src="https://unpkg.com/flexsearch@0.7.31/dist/flexsearch.bundle.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Offline Indicator -->
        <div class="offline-banner" id="offlineBanner">
            <span class="offline-icon">üì°</span>
            <span class="offline-text">Offline rezim - vsechna data jsou ulozena lokalne</span>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../../index.html" class="back-link" title="Zpet na AdHUB">
                    <span class="back-icon">‚Üê</span>
                </a>
                <h1 class="logo">
                    <span class="logo-icon">üìñ</span>
                    <span class="logo-text">DocBook</span>
                </h1>
                <button class="sidebar-toggle" id="sidebarToggle" title="Skryt sidebar">
                    <span>‚ò∞</span>
                </button>
            </div>

            <div class="sidebar-search">
                <input type="text" id="searchInput" class="search-input" placeholder="Hledat v dokumentaci... (Ctrl+K)" autocomplete="off">
                <span class="search-icon">üîç</span>
            </div>

            <div class="sidebar-actions">
                <button class="btn btn-primary" id="newSpaceBtn" title="Novy prostor">
                    <span>üìÅ</span> Novy prostor
                </button>
            </div>

            <nav class="sidebar-nav" id="sidebarNav">
                <div class="nav-loading" id="navLoading">
                    <span class="spinner">‚è≥</span>
                    <span>Nacitam...</span>
                </div>
                <div class="nav-tree" id="navTree">
                    <!-- Navigation tree will be rendered here -->
                </div>
                <div class="nav-empty" id="navEmpty" style="display: none;">
                    <span class="empty-icon">üìù</span>
                    <p>Zadne prostory</p>
                    <p class="empty-hint">Vytvorte svuj prvni prostor dokumentace</p>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="footer-btn" id="importBtn" title="Import">
                    <span>üì•</span> Import
                </button>
                <button class="footer-btn" id="exportBtn" title="Export">
                    <span>üì§</span> Export
                </button>
                <button class="footer-btn" id="settingsBtn" title="Nastaveni">
                    <span>‚öôÔ∏è</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-icon">üìñ</div>
                    <h2>Vitejte v DocBook</h2>
                    <p class="welcome-description">
                        100% offline dokumentacni platforma. Vytvarejte, organizujte a exportujte
                        dokumentaci bez pripojeni k internetu.
                    </p>
                    <div class="welcome-features">
                        <div class="feature">
                            <span class="feature-icon">‚úèÔ∏è</span>
                            <div class="feature-text">
                                <strong>WYSIWYG Editor</strong>
                                <span>Markdown podpora s nahledem v realnem case</span>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üìÅ</span>
                            <div class="feature-text">
                                <strong>Prostory & Stranky</strong>
                                <span>Organizujte dokumentaci do logickych celku</span>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üîç</span>
                            <div class="feature-text">
                                <strong>Rychle vyhledavani</strong>
                                <span>Fulltext search pres vsechny dokumenty</span>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üì§</span>
                            <div class="feature-text">
                                <strong>Export & Import</strong>
                                <span>JSON, Markdown, HTML formaty</span>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üîí</span>
                            <div class="feature-text">
                                <strong>100% Offline</strong>
                                <span>Data zustavaji ve vasem prohlizeci</span>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üì±</span>
                            <div class="feature-text">
                                <strong>PWA Ready</strong>
                                <span>Nainstalujte si jako desktopovou aplikaci</span>
                            </div>
                        </div>
                    </div>
                    <div class="welcome-actions">
                        <button class="btn btn-primary btn-large" id="welcomeNewSpace">
                            <span>üìÅ</span> Vytvorit prvni prostor
                        </button>
                        <button class="btn btn-secondary btn-large" id="welcomeImport">
                            <span>üì•</span> Importovat data
                        </button>
                    </div>
                    <div class="welcome-stats" id="welcomeStats">
                        <!-- Stats will be shown here if data exists -->
                    </div>
                </div>
            </div>

            <!-- Editor Screen -->
            <div class="editor-screen" id="editorScreen" style="display: none;">
                <div class="editor-header">
                    <div class="breadcrumb" id="breadcrumb">
                        <!-- Breadcrumb navigation -->
                    </div>
                    <div class="editor-actions">
                        <div class="editor-mode-toggle">
                            <button class="mode-btn active" data-mode="edit" title="Editovat">‚úèÔ∏è</button>
                            <button class="mode-btn" data-mode="preview" title="Nahled">üëÅÔ∏è</button>
                            <button class="mode-btn" data-mode="split" title="Rozdeleny pohled">‚ó´</button>
                        </div>
                        <button class="btn btn-icon" id="undoBtn" title="Zpet (Ctrl+Z)" disabled>
                            <span>‚Ü©Ô∏è</span>
                        </button>
                        <button class="btn btn-icon" id="redoBtn" title="Vpred (Ctrl+Y)" disabled>
                            <span>‚Ü™Ô∏è</span>
                        </button>
                        <button class="btn btn-icon" id="saveBtn" title="Ulozit (Ctrl+S)">
                            <span>üíæ</span>
                        </button>
                        <button class="btn btn-icon" id="pageSettingsBtn" title="Nastaveni stranky">
                            <span>‚öôÔ∏è</span>
                        </button>
                        <button class="btn btn-icon btn-danger" id="deletePageBtn" title="Smazat stranku">
                            <span>üóëÔ∏è</span>
                        </button>
                    </div>
                </div>

                <div class="editor-container" id="editorContainer">
                    <div class="editor-toolbar" id="editorToolbar">
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-action="bold" title="Tucne (Ctrl+B)"><b>B</b></button>
                            <button class="toolbar-btn" data-action="italic" title="Kurziva (Ctrl+I)"><i>I</i></button>
                            <button class="toolbar-btn" data-action="strikethrough" title="Preskrtnute"><s>S</s></button>
                            <button class="toolbar-btn" data-action="code" title="Inline kod">&lt;/&gt;</button>
                        </div>
                        <div class="toolbar-separator"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-action="h1" title="Nadpis 1">H1</button>
                            <button class="toolbar-btn" data-action="h2" title="Nadpis 2">H2</button>
                            <button class="toolbar-btn" data-action="h3" title="Nadpis 3">H3</button>
                        </div>
                        <div class="toolbar-separator"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-action="ul" title="Neƒç√≠slovan√Ω seznam">‚Ä¢</button>
                            <button class="toolbar-btn" data-action="ol" title="ƒå√≠slovan√Ω seznam">1.</button>
                            <button class="toolbar-btn" data-action="checklist" title="Checklist">‚òë</button>
                            <button class="toolbar-btn" data-action="quote" title="Citace">"</button>
                        </div>
                        <div class="toolbar-separator"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-action="link" title="Odkaz">üîó</button>
                            <button class="toolbar-btn" data-action="image" title="Obrazek">üñºÔ∏è</button>
                            <button class="toolbar-btn" data-action="table" title="Tabulka">üìä</button>
                            <button class="toolbar-btn" data-action="codeblock" title="Blok kodu">üìù</button>
                            <button class="toolbar-btn" data-action="hr" title="Horizontalni linka">‚Äï</button>
                        </div>
                    </div>

                    <div class="editor-body">
                        <div class="editor-pane edit-pane" id="editPane">
                            <textarea class="editor-textarea" id="editorTextarea" placeholder="Zacnete psat... Pouzijte Markdown pro formatovani."></textarea>
                        </div>
                        <div class="editor-pane preview-pane" id="previewPane" style="display: none;">
                            <div class="preview-content" id="previewContent">
                                <!-- Rendered markdown preview -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="editor-toc" id="editorToc">
                    <div class="toc-header">
                        <span>üìë Obsah</span>
                        <button class="toc-toggle" id="tocToggle" title="Skryt obsah">√ó</button>
                    </div>
                    <div class="toc-content" id="tocContent">
                        <!-- Table of contents generated from headings -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Search Modal -->
    <div class="modal-overlay" id="searchModal">
        <div class="modal-content search-modal">
            <div class="modal-header">
                <h2>üîç Hledat v dokumentaci</h2>
                <button class="modal-close" id="closeSearchModal">√ó</button>
            </div>
            <div class="modal-body">
                <input type="text" id="modalSearchInput" class="modal-search-input" placeholder="Hledany vyraz..." autofocus>
                <div class="search-results" id="searchResults">
                    <div class="search-empty">
                        <span>Zacnete psat pro vyhledavani...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Space Modal -->
    <div class="modal-overlay" id="newSpaceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÅ Novy prostor</h2>
                <button class="modal-close" data-close="newSpaceModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="spaceNameInput">Nazev prostoru</label>
                    <input type="text" id="spaceNameInput" class="form-input" placeholder="Napr. Dokumentace projektu" autofocus>
                </div>
                <div class="form-group">
                    <label for="spaceDescInput">Popis (volitelne)</label>
                    <textarea id="spaceDescInput" class="form-textarea" placeholder="Kratky popis prostoru..."></textarea>
                </div>
                <div class="form-group">
                    <label for="spaceIconInput">Ikona</label>
                    <div class="icon-picker" id="spaceIconPicker">
                        <button class="icon-option selected" data-icon="üìÅ">üìÅ</button>
                        <button class="icon-option" data-icon="üìö">üìö</button>
                        <button class="icon-option" data-icon="üìñ">üìñ</button>
                        <button class="icon-option" data-icon="üìù">üìù</button>
                        <button class="icon-option" data-icon="üéØ">üéØ</button>
                        <button class="icon-option" data-icon="üí°">üí°</button>
                        <button class="icon-option" data-icon="‚ö°">‚ö°</button>
                        <button class="icon-option" data-icon="üîß">üîß</button>
                        <button class="icon-option" data-icon="üöÄ">üöÄ</button>
                        <button class="icon-option" data-icon="üé®">üé®</button>
                        <button class="icon-option" data-icon="üìä">üìä</button>
                        <button class="icon-option" data-icon="üîí">üîí</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="newSpaceModal">Zrusit</button>
                <button class="btn btn-primary" id="createSpaceBtn">Vytvorit</button>
            </div>
        </div>
    </div>

    <!-- New Page Modal -->
    <div class="modal-overlay" id="newPageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÑ Nova stranka</h2>
                <button class="modal-close" data-close="newPageModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="pageNameInput">Nazev stranky</label>
                    <input type="text" id="pageNameInput" class="form-input" placeholder="Napr. Uvod" autofocus>
                </div>
                <div class="form-group">
                    <label for="pageParentSelect">Nadrazena stranka (volitelne)</label>
                    <select id="pageParentSelect" class="form-select">
                        <option value="">-- Zadna (root stranka) --</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="newPageModal">Zrusit</button>
                <button class="btn btn-primary" id="createPageBtn">Vytvorit</button>
            </div>
        </div>
    </div>

    <!-- Page Settings Modal -->
    <div class="modal-overlay" id="pageSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Nastaveni stranky</h2>
                <button class="modal-close" data-close="pageSettingsModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="pageSettingsName">Nazev stranky</label>
                    <input type="text" id="pageSettingsName" class="form-input">
                </div>
                <div class="form-group">
                    <label for="pageSettingsSlug">Slug (URL)</label>
                    <input type="text" id="pageSettingsSlug" class="form-input" placeholder="automaticky-vygenerovano">
                </div>
                <div class="form-group">
                    <label for="pageSettingsParent">Nadrazena stranka</label>
                    <select id="pageSettingsParent" class="form-select">
                        <option value="">-- Zadna (root stranka) --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Metadata</label>
                    <div class="metadata-info">
                        <span>Vytvoreno: <strong id="pageCreatedAt">-</strong></span>
                        <span>Upraveno: <strong id="pageUpdatedAt">-</strong></span>
                        <span>Pocet slov: <strong id="pageWordCount">0</strong></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="pageSettingsModal">Zrusit</button>
                <button class="btn btn-primary" id="savePageSettingsBtn">Ulozit</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Nastaveni</h2>
                <button class="modal-close" data-close="settingsModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Editor</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="settingAutoSave" checked>
                            <span>Automaticke ukladani (kazdych 30s)</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="settingSpellcheck">
                            <span>Kontrola pravopisu</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="settingFontSize">Velikost pisma editoru</label>
                        <select id="settingFontSize" class="form-select">
                            <option value="14">Mala (14px)</option>
                            <option value="16" selected>Stredni (16px)</option>
                            <option value="18">Velka (18px)</option>
                            <option value="20">Extra velka (20px)</option>
                        </select>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Data</h3>
                    <div class="form-group">
                        <label>Uloziste</label>
                        <div class="storage-info" id="storageInfo">
                            <span>Prostory: <strong id="storageSpaces">0</strong></span>
                            <span>Stranky: <strong id="storagePages">0</strong></span>
                            <span>Velikost: <strong id="storageSize">0 KB</strong></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-danger" id="clearAllDataBtn">
                            üóëÔ∏è Smazat vsechna data
                        </button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>O aplikaci</h3>
                    <div class="about-info">
                        <p><strong>DocBook</strong> v1.0.0</p>
                        <p>100% offline dokumentacni platforma</p>
                        <p>Inspirovano: GitBook</p>
                        <p class="about-license">
                            Knihovny: Dexie.js (Apache 2.0), Marked.js (MIT),
                            DOMPurify (Apache 2.0/MIT), FlexSearch (Apache 2.0)
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="settingsModal">Zavrit</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì§ Export</h2>
                <button class="modal-close" data-close="exportModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <h3>Co exportovat?</h3>
                    <div class="form-group">
                        <label class="radio-label">
                            <input type="radio" name="exportScope" value="all" checked>
                            <span>Vsechna data</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exportScope" value="space">
                            <span>Aktualni prostor</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exportScope" value="page">
                            <span>Aktualni stranka</span>
                        </label>
                    </div>
                    <h3>Format</h3>
                    <div class="form-group">
                        <label class="radio-label">
                            <input type="radio" name="exportFormat" value="json" checked>
                            <span>JSON (kompletni zaloha)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exportFormat" value="markdown">
                            <span>Markdown soubory (ZIP)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exportFormat" value="html">
                            <span>HTML (staticke stranky)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="exportModal">Zrusit</button>
                <button class="btn btn-primary" id="doExportBtn">üì§ Exportovat</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì• Import</h2>
                <button class="modal-close" data-close="importModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="import-drop-zone" id="importDropZone">
                    <div class="drop-zone-content">
                        <span class="drop-icon">üìÅ</span>
                        <p>Pretahnete sem soubor</p>
                        <p class="drop-hint">nebo kliknete pro vyber</p>
                        <input type="file" id="importFileInput" accept=".json,.md,.zip" hidden>
                    </div>
                </div>
                <div class="import-info">
                    <p>Podporovane formaty:</p>
                    <ul>
                        <li><strong>.json</strong> - DocBook zaloha</li>
                        <li><strong>.md</strong> - Markdown soubor</li>
                        <li><strong>.zip</strong> - Slozka s Markdown soubory</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="importModal">Zrusit</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üóëÔ∏è Potvrzeni smazani</h2>
                <button class="modal-close" data-close="deleteModal">√ó</button>
            </div>
            <div class="modal-body">
                <p class="delete-warning" id="deleteWarning">
                    Opravdu chcete smazat tuto polozku?
                </p>
                <p class="delete-hint">Tato akce je nevratna!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close="deleteModal">Zrusit</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Smazat</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="db.js?v=1.0.0"></script>
    <script src="search.js?v=1.0.0"></script>
    <script src="editor.js?v=1.0.0"></script>
    <script src="export.js?v=1.0.0"></script>
    <script src="app.js?v=1.0.0"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered:', reg.scope))
                    .catch(err => console.error('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
