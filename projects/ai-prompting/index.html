<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Formatter</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- LZ-String compression library -->
    <script src="https://unpkg.com/lz-string@1.5.0/libs/lz-string.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
        }
        #root { min-height: 100vh; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(251,191,36,0.4); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(251,191,36,0.6); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .animate-pulse { animation: pulse 2s infinite; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            750: '#293548',
                            850: '#172033',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // ==================== LANGUAGES ====================
        const languages = [
            { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
            { code: 'cs', name: 'ÄŒeÅ¡tina', flag: 'ðŸ‡¨ðŸ‡¿' },
            { code: 'de', name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
            { code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
            { code: 'fr', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },
        ];

        // ==================== TRANSLATIONS ====================
        const translations = {
            en: {
                title: 'AI Prompt Formatter',
                subtitle: 'Research-backed prompting techniques from 2025 studies',
                backToHub: 'Back to Hub',
                templates: {
                    general: { name: 'General Task', desc: 'Flexible format for any task' },
                    coding: { name: 'Coding Help', desc: 'Debug, write, or explain code' },
                    creative: { name: 'Creative Writing', desc: 'Stories, content, copywriting' },
                    analysis: { name: 'Analysis', desc: 'Research, compare, evaluate' },
                    explanation: { name: 'Explanation', desc: 'Teach or clarify concepts' },
                },
                fields: {
                    role: { label: 'Role / Persona', placeholder: 'e.g., an expert technical writer' },
                    task: { label: 'Task', placeholder: 'e.g., Write documentation for a REST API endpoint' },
                    context: { label: 'Context / Background', placeholder: 'e.g., This is for a fintech startup' },
                    constraints: { label: 'Constraints / Requirements', placeholder: 'e.g., Keep it concise, use examples' },
                    steps: { label: 'Steps to Follow', placeholder: 'Enter each step on a new line...' },
                    outputFormat: { label: 'Output Format', placeholder: 'e.g., Markdown with headers and code blocks' },
                    expectations: { label: 'Expectations / End Goal', placeholder: 'e.g., Clear, actionable documentation' },
                    examples: { label: 'Examples (optional)', placeholder: 'e.g., Input: ... â†’ Output: ...' },
                    fewshot: { label: 'Few-Shot Examples (Input â†’ Output)', placeholder: 'Input: ... â†’ Output: ...' },
                },
                methods: {
                    title: 'Research-Backed Methods',
                    active: 'method(s) active',
                    cot: { name: 'Chain-of-Thought', citation: 'Google DeepMind', tip: 'Best for math, logic, multi-step problems.' },
                    fewshot: { name: 'Few-Shot Learning', citation: 'UMD + OpenAI + Stanford', tip: 'Can improve accuracy from 0% to 90%.' },
                    tot: { name: 'Tree of Thoughts', citation: 'Princeton + Google', tip: 'Best for complex planning and puzzles.' },
                    selfconsistency: { name: 'Self-Consistency', citation: 'Google Research', tip: 'Multiple paths, majority vote.' },
                    react: { name: 'ReAct', citation: 'Princeton + Google', tip: 'Best for tasks needing external tools.' },
                    risen: { name: 'RISEN Framework', citation: 'Kyle Balmer', tip: 'Structured approach for complex tasks.' },
                    emotion: { name: 'EmotionPrompt', citation: 'Microsoft + PKU', tip: 'Emotional stimuli enhance performance.' },
                },
                database: {
                    title: 'Saved Prompts',
                    save: 'Save',
                    load: 'Load',
                    delete: 'Delete',
                    duplicate: 'Duplicate',
                    edit: 'Edit',
                    export: 'Export JSON',
                    import: 'Import JSON',
                    noPrompts: 'No saved prompts yet',
                    promptName: 'Prompt name',
                    saveAs: 'Save prompt as...',
                    confirmDelete: 'Delete this prompt?',
                    imported: 'Prompts imported successfully!',
                    exportedCount: 'prompts exported',
                    savedCount: 'prompts saved',
                },
                share: {
                    title: 'Share Prompt',
                    subtitle: 'Share your prompt settings via code',
                    codeLabel: 'Share Code',
                    wordsLabel: 'Word Phrase (alternative)',
                    urlLabel: 'Direct Link',
                    copyCode: 'Copy Code',
                    copyWords: 'Copy Words',
                    copyUrl: 'Copy Link',
                    importTitle: 'Import from Code',
                    importPlaceholder: 'Paste share code here...',
                    importBtn: 'Load Prompt',
                    importSuccess: 'Prompt loaded successfully!',
                    importError: 'Invalid share code',
                    generating: 'Generating...',
                    tip: 'Tip: The code contains all your settings. Share it via message or email!',
                },
                preview: 'Formatted Prompt',
                copy: 'Copy',
                copied: 'Copied!',
                placeholder: 'Fill in the fields to see your formatted prompt',
                chars: 'chars',
                optimizedFor: 'Optimized for',
                required: '*',
                newPrompt: 'New',
                footer: 'Methods based on: The Prompt Report (UMD, OpenAI, Stanford, 2025) â€¢ Wharton GenAI Labs â€¢ Google DeepMind â€¢ Princeton NLP',
                promptParts: {
                    youAre: 'You are', actAs: 'Act as', role: 'Role',
                    emotion: 'This task is very important to me. Your thorough and careful response will greatly help my work.',
                    context: 'Background/Context', task: 'Task',
                    cotInstructions: 'Think through this step-by-step:\n1. First, analyze the problem carefully\n2. Break it down into logical steps\n3. Show your reasoning for each step\n4. Then provide your final answer',
                    cotSimple: "Let's think through this step-by-step. Show your reasoning at each stage before reaching a conclusion.",
                    totExperts: "Imagine 3 different experts approaching this problem:\n- Expert 1: Takes a methodical, systematic approach\n- Expert 2: Looks for creative, unconventional solutions\n- Expert 3: Focuses on practical, efficient solutions\n\nEach expert shares one step of their thinking, then evaluates. If any approach seems wrong, abandon it and explore alternatives. Continue until reaching the best solution.",
                    totSimple: "Consider 3 different approaches to this problem. For each, take one step, evaluate if it's promising, and continue the best paths while abandoning dead ends.",
                    scVerify: 'Generate 3 independent solutions using different reasoning approaches. Then compare them and select the answer that appears most consistently across approaches, explaining why.',
                    scSimple: 'Solve this problem 3 different ways, then compare your answers and explain which is most likely correct and why.',
                    reactCycle: 'Follow this Thought-Action-Observation cycle:\n1. Thought: Reason about what you need to do next\n2. Action: Describe what action to take\n3. Observation: Note what you learned from the action\nRepeat until you have a complete solution.',
                    reactSimple: 'For each step, state your Thought (reasoning), Action (what to do), and Observation (what you learned). Repeat this cycle until solved.',
                    stepsFollow: 'Follow these steps', constraints: 'Requirements/Constraints',
                    examplesIntro: 'Here are examples of the expected input-output format:', examplesFollow: 'Follow these patterns for your response.',
                    fewshotIntro: 'Learn from these examples:', fewshotFollow: 'Apply the same pattern to the current task.',
                    outputFormat: 'Expected Output Format', expectations: 'Expected Outcome',
                }
            },
            cs: {
                title: 'AI FormÃ¡tovaÄ PromptÅ¯',
                subtitle: 'Techniky promptovÃ¡nÃ­ zaloÅ¾enÃ© na vÃ½zkumu z roku 2025',
                backToHub: 'ZpÄ›t do Hubu',
                templates: {
                    general: { name: 'ObecnÃ½ Ãºkol', desc: 'FlexibilnÃ­ formÃ¡t pro jakÃ½koli Ãºkol' },
                    coding: { name: 'ProgramovÃ¡nÃ­', desc: 'LadÄ›nÃ­, psanÃ­ nebo vysvÄ›tlenÃ­ kÃ³du' },
                    creative: { name: 'KreativnÃ­ psanÃ­', desc: 'PÅ™Ã­bÄ›hy, obsah, copywriting' },
                    analysis: { name: 'AnalÃ½za', desc: 'VÃ½zkum, porovnÃ¡nÃ­, hodnocenÃ­' },
                    explanation: { name: 'VysvÄ›tlenÃ­', desc: 'VÃ½uka nebo objasnÄ›nÃ­ konceptÅ¯' },
                },
                fields: {
                    role: { label: 'Role / Persona', placeholder: 'napÅ™. expertnÃ­ technickÃ½ autor' },
                    task: { label: 'Ãškol', placeholder: 'napÅ™. NapiÅ¡te dokumentaci pro REST API endpoint' },
                    context: { label: 'Kontext / PozadÃ­', placeholder: 'napÅ™. Toto je pro fintech startup' },
                    constraints: { label: 'OmezenÃ­ / PoÅ¾adavky', placeholder: 'napÅ™. BuÄte struÄnÃ­, pouÅ¾Ã­vejte pÅ™Ã­klady' },
                    steps: { label: 'Kroky k nÃ¡sledovÃ¡nÃ­', placeholder: 'Zadejte kaÅ¾dÃ½ krok na novÃ½ Å™Ã¡dek...' },
                    outputFormat: { label: 'FormÃ¡t vÃ½stupu', placeholder: 'napÅ™. Markdown s nadpisy a bloky kÃ³du' },
                    expectations: { label: 'OÄekÃ¡vÃ¡nÃ­ / CÃ­l', placeholder: 'napÅ™. JasnÃ¡, pouÅ¾itelnÃ¡ dokumentace' },
                    examples: { label: 'PÅ™Ã­klady (volitelnÃ©)', placeholder: 'napÅ™. Vstup: ... â†’ VÃ½stup: ...' },
                    fewshot: { label: 'Few-Shot pÅ™Ã­klady (Vstup â†’ VÃ½stup)', placeholder: 'Vstup: ... â†’ VÃ½stup: ...' },
                },
                methods: {
                    title: 'Metody zaloÅ¾enÃ© na vÃ½zkumu',
                    active: 'aktivnÃ­ metod(y)',
                    cot: { name: 'Chain-of-Thought', citation: 'Google DeepMind', tip: 'NejlepÅ¡Ã­ pro matematiku a logiku.' },
                    fewshot: { name: 'Few-Shot uÄenÃ­', citation: 'UMD + OpenAI + Stanford', tip: 'MÅ¯Å¾e zlepÅ¡it pÅ™esnost z 0% na 90%.' },
                    tot: { name: 'Tree of Thoughts', citation: 'Princeton + Google', tip: 'NejlepÅ¡Ã­ pro komplexnÃ­ plÃ¡novÃ¡nÃ­.' },
                    selfconsistency: { name: 'Self-Consistency', citation: 'Google Research', tip: 'VÃ­ce cest, vÄ›tÅ¡inovÃ© hlasovÃ¡nÃ­.' },
                    react: { name: 'ReAct', citation: 'Princeton + Google', tip: 'Pro Ãºkoly vyÅ¾adujÃ­cÃ­ externÃ­ nÃ¡stroje.' },
                    risen: { name: 'RISEN Framework', citation: 'Kyle Balmer', tip: 'StrukturovanÃ½ pÅ™Ã­stup pro sloÅ¾itÃ© Ãºkoly.' },
                    emotion: { name: 'EmotionPrompt', citation: 'Microsoft + PKU', tip: 'EmoÄnÃ­ stimuly zlepÅ¡ujÃ­ vÃ½kon.' },
                },
                database: {
                    title: 'UloÅ¾enÃ© prompty',
                    save: 'UloÅ¾it',
                    load: 'NaÄÃ­st',
                    delete: 'Smazat',
                    duplicate: 'Duplikovat',
                    edit: 'Upravit',
                    export: 'Export JSON',
                    import: 'Import JSON',
                    noPrompts: 'ZatÃ­m Å¾Ã¡dnÃ© uloÅ¾enÃ© prompty',
                    promptName: 'NÃ¡zev promptu',
                    saveAs: 'UloÅ¾it prompt jako...',
                    confirmDelete: 'Smazat tento prompt?',
                    imported: 'Prompty ÃºspÄ›Å¡nÄ› importovÃ¡ny!',
                    exportedCount: 'promptÅ¯ exportovÃ¡no',
                    savedCount: 'promptÅ¯ uloÅ¾eno',
                },
                share: {
                    title: 'SdÃ­let Prompt',
                    subtitle: 'SdÃ­lejte nastavenÃ­ promptu pomocÃ­ kÃ³du',
                    codeLabel: 'SdÃ­lecÃ­ kÃ³d',
                    wordsLabel: 'SlovnÃ­ frÃ¡ze (alternativa)',
                    urlLabel: 'PÅ™Ã­mÃ½ odkaz',
                    copyCode: 'KopÃ­rovat kÃ³d',
                    copyWords: 'KopÃ­rovat slova',
                    copyUrl: 'KopÃ­rovat odkaz',
                    importTitle: 'NaÄÃ­st z kÃ³du',
                    importPlaceholder: 'VloÅ¾te sdÃ­lecÃ­ kÃ³d...',
                    importBtn: 'NaÄÃ­st prompt',
                    importSuccess: 'Prompt ÃºspÄ›Å¡nÄ› naÄten!',
                    importError: 'NeplatnÃ½ sdÃ­lecÃ­ kÃ³d',
                    generating: 'Generuji...',
                    tip: 'Tip: KÃ³d obsahuje vÅ¡echna vaÅ¡e nastavenÃ­. SdÃ­lejte ho pÅ™es zprÃ¡vu nebo email!',
                },
                preview: 'FormÃ¡tovanÃ½ prompt',
                copy: 'KopÃ­rovat',
                copied: 'ZkopÃ­rovÃ¡no!',
                placeholder: 'VyplÅˆte pole pro zobrazenÃ­ formÃ¡tovanÃ©ho promptu',
                chars: 'znakÅ¯',
                optimizedFor: 'OptimalizovÃ¡no pro',
                required: '*',
                newPrompt: 'NovÃ½',
                footer: 'Metody zaloÅ¾enÃ© na: The Prompt Report (UMD, OpenAI, Stanford, 2025) â€¢ Wharton GenAI Labs â€¢ Google DeepMind â€¢ Princeton NLP',
                promptParts: {
                    youAre: 'Jsi', actAs: 'Jednej jako', role: 'Role',
                    emotion: 'Tento Ãºkol je pro mÄ› velmi dÅ¯leÅ¾itÃ½. TvÃ¡ dÅ¯kladnÃ¡ a peÄlivÃ¡ odpovÄ›Ä mi velmi pomÅ¯Å¾e.',
                    context: 'PozadÃ­/Kontext', task: 'Ãškol',
                    cotInstructions: 'PÅ™emÃ½Å¡lej nad tÃ­m krok za krokem:\n1. Nejprve peÄlivÄ› analyzuj problÃ©m\n2. RozdÄ›l ho na logickÃ© kroky\n3. UkaÅ¾ svÃ© uvaÅ¾ovÃ¡nÃ­ pro kaÅ¾dÃ½ krok\n4. PotÃ© poskytni svou koneÄnou odpovÄ›Ä',
                    cotSimple: 'PojÄme to promyslet krok za krokem. UkaÅ¾ svÃ© uvaÅ¾ovÃ¡nÃ­ v kaÅ¾dÃ© fÃ¡zi pÅ™ed dosaÅ¾enÃ­m zÃ¡vÄ›ru.',
                    totExperts: 'PÅ™edstav si 3 rÅ¯znÃ© experty, kteÅ™Ã­ pÅ™istupujÃ­ k tomuto problÃ©mu:\n- Expert 1: PouÅ¾Ã­vÃ¡ metodickÃ½, systematickÃ½ pÅ™Ã­stup\n- Expert 2: HledÃ¡ kreativnÃ­, nekonvenÄnÃ­ Å™eÅ¡enÃ­\n- Expert 3: ZamÄ›Å™uje se na praktickÃ¡, efektivnÃ­ Å™eÅ¡enÃ­\n\nKaÅ¾dÃ½ expert sdÃ­lÃ­ jeden krok svÃ©ho myÅ¡lenÃ­ a potÃ© vyhodnocuje.',
                    totSimple: 'ZvaÅ¾ 3 rÅ¯znÃ© pÅ™Ã­stupy k tomuto problÃ©mu. Pro kaÅ¾dÃ½ udÄ›lej jeden krok, vyhodnoÅ¥, zda je slibnÃ½.',
                    scVerify: 'Vygeneruj 3 nezÃ¡vislÃ¡ Å™eÅ¡enÃ­ pomocÃ­ rÅ¯znÃ½ch pÅ™Ã­stupÅ¯. PotÃ© je porovnej a vyber odpovÄ›Ä, kterÃ¡ se objevuje nejkonzistentnÄ›ji.',
                    scSimple: 'VyÅ™eÅ¡ tento problÃ©m 3 rÅ¯znÃ½mi zpÅ¯soby, potÃ© porovnej svÃ© odpovÄ›di.',
                    reactCycle: 'NÃ¡sleduj tento cyklus MyÅ¡lenka-Akce-PozorovÃ¡nÃ­:\n1. MyÅ¡lenka: UvaÅ¾uj o tom, co je tÅ™eba udÄ›lat\n2. Akce: PopiÅ¡, jakou akci provÃ©st\n3. PozorovÃ¡nÃ­: Zaznamenej, co jsi se nauÄil',
                    reactSimple: 'Pro kaÅ¾dÃ½ krok uveÄ svou MyÅ¡lenku, Akci a PozorovÃ¡nÃ­.',
                    stepsFollow: 'NÃ¡sleduj tyto kroky', constraints: 'PoÅ¾adavky/OmezenÃ­',
                    examplesIntro: 'Zde jsou pÅ™Ã­klady oÄekÃ¡vanÃ©ho formÃ¡tu:', examplesFollow: 'Å˜iÄ se tÄ›mito vzory.',
                    fewshotIntro: 'UÄ se z tÄ›chto pÅ™Ã­kladÅ¯:', fewshotFollow: 'Aplikuj stejnÃ½ vzor na aktuÃ¡lnÃ­ Ãºkol.',
                    outputFormat: 'OÄekÃ¡vanÃ½ formÃ¡t vÃ½stupu', expectations: 'OÄekÃ¡vanÃ½ vÃ½sledek',
                }
            },
            de: {
                title: 'AI Prompt-Formatierer',
                subtitle: 'Forschungsbasierte Prompting-Techniken aus 2025',
                backToHub: 'ZurÃ¼ck zum Hub',
                templates: {
                    general: { name: 'Allgemeine Aufgabe', desc: 'Flexibles Format' },
                    coding: { name: 'Programmierhilfe', desc: 'Debuggen, schreiben' },
                    creative: { name: 'Kreatives Schreiben', desc: 'Geschichten, Inhalte' },
                    analysis: { name: 'Analyse', desc: 'Recherche, vergleichen' },
                    explanation: { name: 'ErklÃ¤rung', desc: 'Lehren oder klÃ¤ren' },
                },
                fields: {
                    role: { label: 'Rolle / Persona', placeholder: 'z.B. technischer Autor' },
                    task: { label: 'Aufgabe', placeholder: 'z.B. Dokumentation schreiben' },
                    context: { label: 'Kontext', placeholder: 'z.B. FÃ¼r ein Startup' },
                    constraints: { label: 'Anforderungen', placeholder: 'z.B. Kurz halten' },
                    steps: { label: 'Schritte', placeholder: 'Jeden Schritt eingeben...' },
                    outputFormat: { label: 'Ausgabeformat', placeholder: 'z.B. Markdown' },
                    expectations: { label: 'Erwartungen', placeholder: 'z.B. Klare Dokumentation' },
                    examples: { label: 'Beispiele', placeholder: 'z.B. Eingabe â†’ Ausgabe' },
                    fewshot: { label: 'Few-Shot Beispiele', placeholder: 'Eingabe â†’ Ausgabe' },
                },
                methods: {
                    title: 'Forschungsbasierte Methoden', active: 'Methode(n) aktiv',
                    cot: { name: 'Chain-of-Thought', citation: 'Google DeepMind', tip: 'FÃ¼r Mathematik und Logik.' },
                    fewshot: { name: 'Few-Shot', citation: 'UMD + OpenAI', tip: 'Verbessert Genauigkeit.' },
                    tot: { name: 'Tree of Thoughts', citation: 'Princeton', tip: 'FÃ¼r komplexe Planung.' },
                    selfconsistency: { name: 'Self-Consistency', citation: 'Google', tip: 'Mehrheitsentscheidung.' },
                    react: { name: 'ReAct', citation: 'Princeton', tip: 'Mit externen Tools.' },
                    risen: { name: 'RISEN', citation: 'Kyle Balmer', tip: 'Strukturierter Ansatz.' },
                    emotion: { name: 'EmotionPrompt', citation: 'Microsoft', tip: 'Emotionale Stimuli.' },
                },
                database: {
                    title: 'Gespeicherte Prompts', save: 'Speichern', load: 'Laden', delete: 'LÃ¶schen',
                    duplicate: 'Duplizieren', edit: 'Bearbeiten', export: 'Export JSON', import: 'Import JSON',
                    noPrompts: 'Keine gespeicherten Prompts', promptName: 'Prompt-Name',
                    saveAs: 'Prompt speichern als...', confirmDelete: 'Diesen Prompt lÃ¶schen?',
                    imported: 'Prompts erfolgreich importiert!', exportedCount: 'Prompts exportiert', savedCount: 'Prompts gespeichert',
                },
                share: {
                    title: 'Prompt teilen', subtitle: 'Teilen Sie Ihre Einstellungen per Code',
                    codeLabel: 'Freigabecode', wordsLabel: 'Wortphrase (alternativ)', urlLabel: 'Direktlink',
                    copyCode: 'Code kopieren', copyWords: 'WÃ¶rter kopieren', copyUrl: 'Link kopieren',
                    importTitle: 'Aus Code laden', importPlaceholder: 'Freigabecode einfÃ¼gen...',
                    importBtn: 'Prompt laden', importSuccess: 'Prompt erfolgreich geladen!',
                    importError: 'UngÃ¼ltiger Code', generating: 'Generiere...',
                    tip: 'Tipp: Der Code enthÃ¤lt alle Einstellungen. Per Nachricht oder E-Mail teilen!',
                },
                preview: 'Formatierter Prompt', copy: 'Kopieren', copied: 'Kopiert!',
                placeholder: 'Felder ausfÃ¼llen', chars: 'Zeichen', optimizedFor: 'Optimiert fÃ¼r',
                required: '*', newPrompt: 'Neu', footer: 'Methoden: The Prompt Report â€¢ Wharton â€¢ DeepMind â€¢ Princeton',
                promptParts: {
                    youAre: 'Du bist', actAs: 'Agiere als', role: 'Rolle',
                    emotion: 'Diese Aufgabe ist sehr wichtig fÃ¼r mich.',
                    context: 'Kontext', task: 'Aufgabe',
                    cotInstructions: 'Denke Schritt fÃ¼r Schritt:\n1. Analysiere das Problem\n2. Teile es auf\n3. Zeige deine Ãœberlegungen',
                    cotSimple: 'Lass uns das Schritt fÃ¼r Schritt durchdenken.',
                    totExperts: 'Stelle dir 3 Experten vor mit verschiedenen AnsÃ¤tzen.',
                    totSimple: 'Betrachte 3 verschiedene AnsÃ¤tze.',
                    scVerify: 'Generiere 3 unabhÃ¤ngige LÃ¶sungen und vergleiche.',
                    scSimple: 'LÃ¶se auf 3 Arten und erklÃ¤re die beste.',
                    reactCycle: 'Folge: Gedanke â†’ Aktion â†’ Beobachtung',
                    reactSimple: 'FÃ¼r jeden Schritt: Gedanke, Aktion, Beobachtung.',
                    stepsFollow: 'Folge diesen Schritten', constraints: 'Anforderungen',
                    examplesIntro: 'Beispiele:', examplesFollow: 'Folge diesen Mustern.',
                    fewshotIntro: 'Lerne aus Beispielen:', fewshotFollow: 'Wende das Muster an.',
                    outputFormat: 'Ausgabeformat', expectations: 'Erwartetes Ergebnis',
                }
            },
            es: {
                title: 'Formateador de Prompts',
                subtitle: 'TÃ©cnicas de prompting basadas en investigaciÃ³n 2025',
                backToHub: 'Volver al Hub',
                templates: {
                    general: { name: 'Tarea General', desc: 'Formato flexible' },
                    coding: { name: 'CÃ³digo', desc: 'Depurar, escribir' },
                    creative: { name: 'Escritura Creativa', desc: 'Historias, contenido' },
                    analysis: { name: 'AnÃ¡lisis', desc: 'Investigar, comparar' },
                    explanation: { name: 'ExplicaciÃ³n', desc: 'EnseÃ±ar conceptos' },
                },
                fields: {
                    role: { label: 'Rol / Persona', placeholder: 'ej. escritor tÃ©cnico' },
                    task: { label: 'Tarea', placeholder: 'ej. Escribir documentaciÃ³n' },
                    context: { label: 'Contexto', placeholder: 'ej. Para una startup' },
                    constraints: { label: 'Requisitos', placeholder: 'ej. Ser conciso' },
                    steps: { label: 'Pasos', placeholder: 'Cada paso en nueva lÃ­nea...' },
                    outputFormat: { label: 'Formato de Salida', placeholder: 'ej. Markdown' },
                    expectations: { label: 'Expectativas', placeholder: 'ej. DocumentaciÃ³n clara' },
                    examples: { label: 'Ejemplos', placeholder: 'ej. Entrada â†’ Salida' },
                    fewshot: { label: 'Ejemplos Few-Shot', placeholder: 'Entrada â†’ Salida' },
                },
                methods: {
                    title: 'MÃ©todos de InvestigaciÃ³n', active: 'mÃ©todo(s) activo(s)',
                    cot: { name: 'Chain-of-Thought', citation: 'Google DeepMind', tip: 'Para matemÃ¡ticas y lÃ³gica.' },
                    fewshot: { name: 'Few-Shot', citation: 'UMD + OpenAI', tip: 'Mejora precisiÃ³n.' },
                    tot: { name: 'Tree of Thoughts', citation: 'Princeton', tip: 'PlanificaciÃ³n compleja.' },
                    selfconsistency: { name: 'Self-Consistency', citation: 'Google', tip: 'Voto mayoritario.' },
                    react: { name: 'ReAct', citation: 'Princeton', tip: 'Herramientas externas.' },
                    risen: { name: 'RISEN', citation: 'Kyle Balmer', tip: 'Enfoque estructurado.' },
                    emotion: { name: 'EmotionPrompt', citation: 'Microsoft', tip: 'EstÃ­mulos emocionales.' },
                },
                database: {
                    title: 'Prompts Guardados', save: 'Guardar', load: 'Cargar', delete: 'Eliminar',
                    duplicate: 'Duplicar', edit: 'Editar', export: 'Exportar JSON', import: 'Importar JSON',
                    noPrompts: 'Sin prompts guardados', promptName: 'Nombre del prompt',
                    saveAs: 'Guardar prompt como...', confirmDelete: 'Â¿Eliminar este prompt?',
                    imported: 'Â¡Prompts importados!', exportedCount: 'prompts exportados', savedCount: 'prompts guardados',
                },
                share: {
                    title: 'Compartir Prompt', subtitle: 'Comparte tu configuraciÃ³n mediante cÃ³digo',
                    codeLabel: 'CÃ³digo de compartir', wordsLabel: 'Frase de palabras (alternativa)', urlLabel: 'Enlace directo',
                    copyCode: 'Copiar cÃ³digo', copyWords: 'Copiar palabras', copyUrl: 'Copiar enlace',
                    importTitle: 'Cargar desde cÃ³digo', importPlaceholder: 'Pega el cÃ³digo aquÃ­...',
                    importBtn: 'Cargar prompt', importSuccess: 'Â¡Prompt cargado con Ã©xito!',
                    importError: 'CÃ³digo invÃ¡lido', generating: 'Generando...',
                    tip: 'Consejo: El cÃ³digo contiene toda tu configuraciÃ³n. Â¡CompÃ¡rtelo por mensaje o email!',
                },
                preview: 'Prompt Formateado', copy: 'Copiar', copied: 'Â¡Copiado!',
                placeholder: 'Completa los campos', chars: 'caracteres', optimizedFor: 'Optimizado para',
                required: '*', newPrompt: 'Nuevo', footer: 'MÃ©todos: The Prompt Report â€¢ Wharton â€¢ DeepMind â€¢ Princeton',
                promptParts: {
                    youAre: 'Eres', actAs: 'ActÃºa como', role: 'Rol',
                    emotion: 'Esta tarea es muy importante para mÃ­.',
                    context: 'Contexto', task: 'Tarea',
                    cotInstructions: 'Piensa paso a paso:\n1. Analiza el problema\n2. DivÃ­delo en pasos\n3. Muestra tu razonamiento',
                    cotSimple: 'Pensemos paso a paso.',
                    totExperts: 'Imagina 3 expertos con diferentes enfoques.',
                    totSimple: 'Considera 3 enfoques diferentes.',
                    scVerify: 'Genera 3 soluciones independientes y compara.',
                    scSimple: 'Resuelve de 3 formas y explica la mejor.',
                    reactCycle: 'Sigue: Pensamiento â†’ AcciÃ³n â†’ ObservaciÃ³n',
                    reactSimple: 'Para cada paso: Pensamiento, AcciÃ³n, ObservaciÃ³n.',
                    stepsFollow: 'Sigue estos pasos', constraints: 'Requisitos',
                    examplesIntro: 'Ejemplos:', examplesFollow: 'Sigue estos patrones.',
                    fewshotIntro: 'Aprende de ejemplos:', fewshotFollow: 'Aplica el patrÃ³n.',
                    outputFormat: 'Formato de Salida', expectations: 'Resultado Esperado',
                }
            },
            fr: {
                title: 'Formateur de Prompts',
                subtitle: 'Techniques de prompting basÃ©es sur la recherche 2025',
                backToHub: 'Retour au Hub',
                templates: {
                    general: { name: 'TÃ¢che GÃ©nÃ©rale', desc: 'Format flexible' },
                    coding: { name: 'Code', desc: 'DÃ©boguer, Ã©crire' },
                    creative: { name: 'Ã‰criture CrÃ©ative', desc: 'Histoires, contenu' },
                    analysis: { name: 'Analyse', desc: 'Recherche, comparer' },
                    explanation: { name: 'Explication', desc: 'Enseigner concepts' },
                },
                fields: {
                    role: { label: 'RÃ´le / Persona', placeholder: 'ex. rÃ©dacteur technique' },
                    task: { label: 'TÃ¢che', placeholder: 'ex. Ã‰crire documentation' },
                    context: { label: 'Contexte', placeholder: 'ex. Pour une startup' },
                    constraints: { label: 'Exigences', placeholder: 'ex. ÃŠtre concis' },
                    steps: { label: 'Ã‰tapes', placeholder: 'Chaque Ã©tape sur nouvelle ligne...' },
                    outputFormat: { label: 'Format de Sortie', placeholder: 'ex. Markdown' },
                    expectations: { label: 'Attentes', placeholder: 'ex. Documentation claire' },
                    examples: { label: 'Exemples', placeholder: 'ex. EntrÃ©e â†’ Sortie' },
                    fewshot: { label: 'Exemples Few-Shot', placeholder: 'EntrÃ©e â†’ Sortie' },
                },
                methods: {
                    title: 'MÃ©thodes de Recherche', active: 'mÃ©thode(s) active(s)',
                    cot: { name: 'Chain-of-Thought', citation: 'Google DeepMind', tip: 'Pour maths et logique.' },
                    fewshot: { name: 'Few-Shot', citation: 'UMD + OpenAI', tip: 'AmÃ©liore prÃ©cision.' },
                    tot: { name: 'Tree of Thoughts', citation: 'Princeton', tip: 'Planification complexe.' },
                    selfconsistency: { name: 'Self-Consistency', citation: 'Google', tip: 'Vote majoritaire.' },
                    react: { name: 'ReAct', citation: 'Princeton', tip: 'Outils externes.' },
                    risen: { name: 'RISEN', citation: 'Kyle Balmer', tip: 'Approche structurÃ©e.' },
                    emotion: { name: 'EmotionPrompt', citation: 'Microsoft', tip: 'Stimuli Ã©motionnels.' },
                },
                database: {
                    title: 'Prompts SauvegardÃ©s', save: 'Sauvegarder', load: 'Charger', delete: 'Supprimer',
                    duplicate: 'Dupliquer', edit: 'Modifier', export: 'Exporter JSON', import: 'Importer JSON',
                    noPrompts: 'Aucun prompt sauvegardÃ©', promptName: 'Nom du prompt',
                    saveAs: 'Sauvegarder prompt comme...', confirmDelete: 'Supprimer ce prompt?',
                    imported: 'Prompts importÃ©s!', exportedCount: 'prompts exportÃ©s', savedCount: 'prompts sauvegardÃ©s',
                },
                share: {
                    title: 'Partager Prompt', subtitle: 'Partagez vos paramÃ¨tres par code',
                    codeLabel: 'Code de partage', wordsLabel: 'Phrase de mots (alternative)', urlLabel: 'Lien direct',
                    copyCode: 'Copier code', copyWords: 'Copier mots', copyUrl: 'Copier lien',
                    importTitle: 'Charger depuis code', importPlaceholder: 'Collez le code ici...',
                    importBtn: 'Charger prompt', importSuccess: 'Prompt chargÃ© avec succÃ¨s!',
                    importError: 'Code invalide', generating: 'GÃ©nÃ©ration...',
                    tip: 'Astuce: Le code contient tous vos paramÃ¨tres. Partagez-le par message ou email!',
                },
                preview: 'Prompt FormatÃ©', copy: 'Copier', copied: 'CopiÃ©!',
                placeholder: 'Remplissez les champs', chars: 'caractÃ¨res', optimizedFor: 'OptimisÃ© pour',
                required: '*', newPrompt: 'Nouveau', footer: 'MÃ©thodes: The Prompt Report â€¢ Wharton â€¢ DeepMind â€¢ Princeton',
                promptParts: {
                    youAre: 'Tu es', actAs: 'Agis comme', role: 'RÃ´le',
                    emotion: 'Cette tÃ¢che est trÃ¨s importante pour moi.',
                    context: 'Contexte', task: 'TÃ¢che',
                    cotInstructions: 'RÃ©flÃ©chis Ã©tape par Ã©tape:\n1. Analyse le problÃ¨me\n2. DÃ©compose-le\n3. Montre ton raisonnement',
                    cotSimple: 'RÃ©flÃ©chissons Ã©tape par Ã©tape.',
                    totExperts: 'Imagine 3 experts avec diffÃ©rentes approches.',
                    totSimple: 'ConsidÃ¨re 3 approches diffÃ©rentes.',
                    scVerify: 'GÃ©nÃ¨re 3 solutions indÃ©pendantes et compare.',
                    scSimple: 'RÃ©sous de 3 faÃ§ons et explique la meilleure.',
                    reactCycle: 'Suis: PensÃ©e â†’ Action â†’ Observation',
                    reactSimple: 'Pour chaque Ã©tape: PensÃ©e, Action, Observation.',
                    stepsFollow: 'Suis ces Ã©tapes', constraints: 'Exigences',
                    examplesIntro: 'Exemples:', examplesFollow: 'Suis ces modÃ¨les.',
                    fewshotIntro: 'Apprends des exemples:', fewshotFollow: 'Applique le modÃ¨le.',
                    outputFormat: 'Format de Sortie', expectations: 'RÃ©sultat Attendu',
                }
            },
        };

        // ==================== ICON COMPONENT ====================
        const Icon = ({ name, size = 20, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current && lucide[name]) {
                    ref.current.innerHTML = '';
                    const svg = lucide.createElement(lucide[name]);
                    svg.setAttribute('width', size);
                    svg.setAttribute('height', size);
                    ref.current.appendChild(svg);
                }
            }, [name, size]);
            return <span ref={ref} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        // ==================== LOCALSTORAGE DATABASE ====================
        const DB_KEY = 'ai_prompt_formatter_db';
        const loadDatabase = () => {
            try {
                const data = localStorage.getItem(DB_KEY);
                return data ? JSON.parse(data) : [];
            } catch { return []; }
        };
        const saveDatabase = (prompts) => {
            localStorage.setItem(DB_KEY, JSON.stringify(prompts));
        };

        // ==================== SHARE CODE SYSTEM ====================
        // Generate share code from prompt data (using LZ-String URI encoding)
        const generateShareCode = (promptData) => {
            try {
                const minimal = {
                    t: ['general', 'coding', 'creative', 'analysis', 'explanation'].indexOf(promptData.template),
                    a: ['claude', 'gpt', 'general'].indexOf(promptData.target),
                    m: promptData.selectedMethods.map(m => ['cot', 'fewshot', 'tot', 'selfconsistency', 'react', 'risen', 'emotion'].indexOf(m)).filter(i => i >= 0),
                    l: ['en', 'cs', 'de', 'es', 'fr'].indexOf(promptData.lang),
                    f: promptData.fields
                };
                const json = JSON.stringify(minimal);
                return LZString.compressToEncodedURIComponent(json);
            } catch (e) {
                return null;
            }
        };

        // Decode share code to prompt data
        const decodeShareCode = (code) => {
            try {
                const cleanCode = code.trim().replace(/\s+/g, '');
                const json = LZString.decompressFromEncodedURIComponent(cleanCode);
                if (!json) return null;

                const minimal = JSON.parse(json);
                const templates = ['general', 'coding', 'creative', 'analysis', 'explanation'];
                const targets = ['claude', 'gpt', 'general'];
                const methods = ['cot', 'fewshot', 'tot', 'selfconsistency', 'react', 'risen', 'emotion'];
                const langs = ['en', 'cs', 'de', 'es', 'fr'];

                return {
                    template: templates[minimal.t] || 'general',
                    target: targets[minimal.a] || 'claude',
                    selectedMethods: (minimal.m || []).map(i => methods[i]).filter(Boolean),
                    lang: langs[minimal.l] || 'en',
                    fields: minimal.f || { role: '', task: '', context: '', constraints: '', outputFormat: '', examples: '' }
                };
            } catch (e) {
                return null;
            }
        };

        // Get shareable URL
        const getShareURL = (code) => {
            const url = new URL(window.location.href);
            url.searchParams.set('share', code);
            return url.toString();
        };

        // Check URL for share code on load
        const getShareCodeFromURL = () => {
            const params = new URLSearchParams(window.location.search);
            return params.get('share');
        };

        // ==================== TEMPLATE ICONS ====================
        const templateIcons = { general: 'FileText', coding: 'Code', creative: 'Pencil', analysis: 'Lightbulb', explanation: 'MessageSquare' };
        const methodIcons = { cot: 'Brain', fewshot: 'Zap', tot: 'TreeDeciduous', selfconsistency: 'RefreshCw', react: 'GitBranch', risen: 'Target', emotion: 'Heart' };

        // ==================== MAIN APP ====================
        const App = () => {
            const [lang, setLang] = useState(() => localStorage.getItem('ai-prompt-lang') || 'en');
            const [template, setTemplate] = useState('general');
            const [target, setTarget] = useState('claude');
            const [copied, setCopied] = useState(false);
            const [showTemplates, setShowTemplates] = useState(false);
            const [selectedMethods, setSelectedMethods] = useState([]);
            const [showMethodInfo, setShowMethodInfo] = useState(null);
            const [showLangDropdown, setShowLangDropdown] = useState(false);
            const [showDatabase, setShowDatabase] = useState(false);
            const [savedPrompts, setSavedPrompts] = useState([]);
            const [saveModalOpen, setSaveModalOpen] = useState(false);
            const [promptName, setPromptName] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [notification, setNotification] = useState('');
            const [showShareModal, setShowShareModal] = useState(false);
            const [showImportModal, setShowImportModal] = useState(false);
            const [shareData, setShareData] = useState(null);
            const [importCode, setImportCode] = useState('');

            const [fields, setFields] = useState({
                role: '', task: '', context: '', constraints: '', outputFormat: '', examples: '',
            });

            const t = translations[lang] || translations.en;
            const selectedLang = languages.find(l => l.code === lang);

            // Load database on mount
            useEffect(() => {
                setSavedPrompts(loadDatabase());
            }, []);

            // Save language
            useEffect(() => {
                localStorage.setItem('ai-prompt-lang', lang);
            }, [lang]);

            const showNotification = (msg) => {
                setNotification(msg);
                setTimeout(() => setNotification(''), 3000);
            };

            const updateField = (key, value) => setFields(prev => ({ ...prev, [key]: value }));
            const toggleMethod = (methodId) => setSelectedMethods(prev =>
                prev.includes(methodId) ? prev.filter(m => m !== methodId) : [...prev, methodId]
            );

            const selectedTemplate = t.templates[template];
            const TemplateIcon = templateIcons[template];

            // Generate formatted prompt
            const formattedPrompt = useMemo(() => {
                const parts = [];
                const p = t.promptParts;

                if (fields.role) {
                    parts.push(target === 'claude' ? `${p.youAre} ${fields.role}.` : target === 'gpt' ? `${p.actAs} ${fields.role}.` : `${p.role}: ${fields.role}`);
                    parts.push('');
                }
                if (selectedMethods.includes('emotion')) { parts.push(p.emotion); parts.push(''); }
                if (fields.context) {
                    parts.push(target === 'claude' ? `<context>\n${fields.context}\n</context>` : `**${p.context}:**\n${fields.context}`);
                    parts.push('');
                }
                if (fields.task) {
                    parts.push(target === 'claude' ? `<task>\n${fields.task}\n</task>` : target === 'gpt' ? `**${p.task}:**\n${fields.task}` : `${p.task}: ${fields.task}`);
                    parts.push('');
                }
                if (selectedMethods.includes('cot')) {
                    parts.push(target === 'claude' ? `<instructions>\n${p.cotInstructions}\n</instructions>` : `**Instructions:** ${p.cotSimple}`);
                    parts.push('');
                }
                if (selectedMethods.includes('tot')) {
                    parts.push(target === 'claude' ? `<reasoning_approach>\n${p.totExperts}\n</reasoning_approach>` : `**Multi-path:** ${p.totSimple}`);
                    parts.push('');
                }
                if (selectedMethods.includes('selfconsistency')) {
                    parts.push(target === 'claude' ? `<verification>\n${p.scVerify}\n</verification>` : `**Self-verification:** ${p.scSimple}`);
                    parts.push('');
                }
                if (selectedMethods.includes('react')) {
                    parts.push(target === 'claude' ? `<approach>\n${p.reactCycle}\n</approach>` : `**ReAct:** ${p.reactSimple}`);
                    parts.push('');
                }
                if (selectedMethods.includes('risen') && fields.constraints) {
                    const steps = fields.constraints.split('\n').map((s, i) => `${i + 1}. ${s}`).join('\n');
                    parts.push(target === 'claude' ? `<steps>\n${p.stepsFollow}:\n${steps}\n</steps>` : `**${p.stepsFollow}:**\n${steps}`);
                    parts.push('');
                } else if (fields.constraints) {
                    parts.push(target === 'claude' ? `<constraints>\n${fields.constraints}\n</constraints>` : `**${p.constraints}:**\n${fields.constraints}`);
                    parts.push('');
                }
                if (fields.examples) {
                    if (selectedMethods.includes('fewshot')) {
                        parts.push(target === 'claude' ? `<examples>\n${p.examplesIntro}\n\n${fields.examples}\n\n${p.examplesFollow}\n</examples>` : `**Few-shot:**\n${p.fewshotIntro}\n\n${fields.examples}\n\n${p.fewshotFollow}`);
                    } else {
                        parts.push(target === 'claude' ? `<examples>\n${fields.examples}\n</examples>` : `**Examples:**\n${fields.examples}`);
                    }
                    parts.push('');
                }
                if (fields.outputFormat) {
                    if (selectedMethods.includes('risen')) {
                        parts.push(target === 'claude' ? `<expectations>\n${fields.outputFormat}\n</expectations>` : `**${p.expectations}:**\n${fields.outputFormat}`);
                    } else {
                        parts.push(target === 'claude' ? `<output_format>\n${fields.outputFormat}\n</output_format>` : `**${p.outputFormat}:**\n${fields.outputFormat}`);
                    }
                }
                return parts.join('\n').trim();
            }, [fields, target, selectedMethods, t]);

            const copyToClipboard = async () => {
                await navigator.clipboard.writeText(formattedPrompt);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            // Database functions
            const savePrompt = () => {
                if (!promptName.trim()) return;
                const newPrompt = {
                    id: editingId || Date.now().toString(),
                    name: promptName,
                    template, target, fields, selectedMethods, lang,
                    createdAt: editingId ? savedPrompts.find(p => p.id === editingId)?.createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                };
                let updated;
                if (editingId) {
                    updated = savedPrompts.map(p => p.id === editingId ? newPrompt : p);
                } else {
                    updated = [...savedPrompts, newPrompt];
                }
                setSavedPrompts(updated);
                saveDatabase(updated);
                setSaveModalOpen(false);
                setPromptName('');
                setEditingId(null);
                showNotification(`${updated.length} ${t.database.savedCount}`);
            };

            const loadPrompt = (prompt) => {
                setTemplate(prompt.template || 'general');
                setTarget(prompt.target || 'claude');
                setFields(prompt.fields || { role: '', task: '', context: '', constraints: '', outputFormat: '', examples: '' });
                setSelectedMethods(prompt.selectedMethods || []);
                if (prompt.lang) setLang(prompt.lang);
                setShowDatabase(false);
            };

            const deletePrompt = (id) => {
                const updated = savedPrompts.filter(p => p.id !== id);
                setSavedPrompts(updated);
                saveDatabase(updated);
            };

            const duplicatePrompt = (prompt) => {
                const newPrompt = { ...prompt, id: Date.now().toString(), name: `${prompt.name} (copy)`, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() };
                const updated = [...savedPrompts, newPrompt];
                setSavedPrompts(updated);
                saveDatabase(updated);
            };

            const editPrompt = (prompt) => {
                loadPrompt(prompt);
                setEditingId(prompt.id);
                setPromptName(prompt.name);
                setSaveModalOpen(true);
                setShowDatabase(false);
            };

            const exportDatabase = () => {
                const dataStr = JSON.stringify(savedPrompts, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `prompts_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showNotification(`${savedPrompts.length} ${t.database.exportedCount}`);
            };

            const importDatabase = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target?.result);
                        if (Array.isArray(imported)) {
                            const merged = [...savedPrompts, ...imported.map(p => ({ ...p, id: Date.now().toString() + Math.random() }))];
                            setSavedPrompts(merged);
                            saveDatabase(merged);
                            showNotification(t.database.imported);
                        }
                    } catch { showNotification('Import failed'); }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const resetForm = () => {
                setFields({ role: '', task: '', context: '', constraints: '', outputFormat: '', examples: '' });
                setSelectedMethods([]);
                setEditingId(null);
            };

            // Share code functions
            const openShareModal = () => {
                const promptData = { template, target, selectedMethods, lang, fields };
                const code = generateShareCode(promptData);
                if (code) {
                    setShareData({
                        code: code,
                        url: getShareURL(code)
                    });
                    setShowShareModal(true);
                }
            };

            const copyShareCode = async (text) => {
                await navigator.clipboard.writeText(text);
                showNotification(t.copied);
            };

            const importFromCode = () => {
                const decoded = decodeShareCode(importCode);
                if (decoded) {
                    setTemplate(decoded.template);
                    setTarget(decoded.target);
                    setSelectedMethods(decoded.selectedMethods);
                    setLang(decoded.lang);
                    setFields(decoded.fields);
                    setShowImportModal(false);
                    setImportCode('');
                    showNotification(t.share.importSuccess);
                } else {
                    showNotification(t.share.importError);
                }
            };

            // Check for share code in URL on mount
            useEffect(() => {
                const urlCode = getShareCodeFromURL();
                if (urlCode) {
                    const decoded = decodeShareCode(urlCode);
                    if (decoded) {
                        setTemplate(decoded.template);
                        setTarget(decoded.target);
                        setSelectedMethods(decoded.selectedMethods);
                        setLang(decoded.lang);
                        setFields(decoded.fields);
                        showNotification(t.share.importSuccess);
                        // Clean URL
                        window.history.replaceState({}, '', window.location.pathname);
                    }
                }
            }, []);

            const aiTargets = [{ id: 'claude', name: 'Claude' }, { id: 'gpt', name: 'ChatGPT' }, { id: 'general', name: 'Any AI' }];

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 md:p-6">
                    {/* Notification */}
                    {notification && (
                        <div className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-pulse">
                            {notification}
                        </div>
                    )}

                    {/* Save Modal */}
                    {saveModalOpen && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={() => setSaveModalOpen(false)}>
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 w-96" onClick={e => e.stopPropagation()}>
                                <h3 className="text-lg font-bold text-white mb-4">{t.database.saveAs}</h3>
                                <input
                                    type="text"
                                    value={promptName}
                                    onChange={e => setPromptName(e.target.value)}
                                    placeholder={t.database.promptName}
                                    className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"
                                    autoFocus
                                />
                                <div className="flex gap-2">
                                    <button onClick={() => setSaveModalOpen(false)} className="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600">
                                        Cancel
                                    </button>
                                    <button onClick={savePrompt} className="flex-1 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg hover:bg-amber-400 font-medium">
                                        {t.database.save}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Share Modal - Compact Design */}
                    {showShareModal && shareData && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={() => setShowShareModal(false)}>
                            <div className="bg-slate-800 p-5 rounded-xl border border-slate-700 w-[380px] max-w-[95vw]" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                        <Icon name="Share2" size={20} className="text-amber-400" />
                                        {t.share.title}
                                    </h3>
                                    <button onClick={() => setShowShareModal(false)} className="text-slate-400 hover:text-white">
                                        <Icon name="X" size={20} />
                                    </button>
                                </div>

                                {/* Share Code */}
                                <div className="mb-4">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xs text-slate-400">{t.share.codeLabel}:</span>
                                        <span className="text-xs text-slate-500">({shareData.code.length} chars)</span>
                                    </div>
                                    <div className="p-3 bg-slate-900 border border-slate-600 rounded-lg font-mono text-xs text-amber-400 break-all max-h-24 overflow-y-auto select-all">
                                        {shareData.code}
                                    </div>
                                </div>

                                {/* Action Buttons */}
                                <div className="grid grid-cols-2 gap-2 mb-3">
                                    <button onClick={() => copyShareCode(shareData.code)}
                                        className="px-3 py-2.5 bg-amber-500 text-slate-900 rounded-lg hover:bg-amber-400 font-medium text-sm flex items-center justify-center gap-2">
                                        <Icon name="Copy" size={16} /> {t.share.copyCode}
                                    </button>
                                    <button onClick={() => copyShareCode(shareData.url)}
                                        className="px-3 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-500 font-medium text-sm flex items-center justify-center gap-2">
                                        <Icon name="Link" size={16} /> {t.share.copyUrl}
                                    </button>
                                </div>

                                {/* Tip */}
                                <div className="p-2 bg-slate-700/30 rounded-lg border border-slate-700/50">
                                    <p className="text-xs text-slate-500 flex items-start gap-2">
                                        <Icon name="Lightbulb" size={12} className="text-amber-400/70 flex-shrink-0 mt-0.5" />
                                        {t.share.tip}
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Import Modal */}
                    {showImportModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={() => setShowImportModal(false)}>
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 w-96" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                        <Icon name="Download" size={20} className="text-amber-400" />
                                        {t.share.importTitle}
                                    </h3>
                                    <button onClick={() => setShowImportModal(false)} className="text-slate-400 hover:text-white">
                                        <Icon name="X" size={20} />
                                    </button>
                                </div>
                                <textarea
                                    value={importCode}
                                    onChange={e => setImportCode(e.target.value)}
                                    placeholder={t.share.importPlaceholder}
                                    rows={4}
                                    className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500 font-mono text-sm"
                                    autoFocus
                                />
                                <div className="flex gap-2">
                                    <button onClick={() => setShowImportModal(false)} className="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600">
                                        Cancel
                                    </button>
                                    <button onClick={importFromCode} disabled={!importCode.trim()}
                                        className="flex-1 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg hover:bg-amber-400 font-medium disabled:opacity-50">
                                        {t.share.importBtn}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Database Panel */}
                    {showDatabase && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={() => setShowDatabase(false)}>
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 w-[500px] max-h-[80vh] overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                        <Icon name="Database" size={20} className="text-amber-400" />
                                        {t.database.title} ({savedPrompts.length})
                                    </h3>
                                    <button onClick={() => setShowDatabase(false)} className="text-slate-400 hover:text-white">
                                        <Icon name="X" size={20} />
                                    </button>
                                </div>

                                {/* Import/Export */}
                                <div className="flex gap-2 mb-4">
                                    <button onClick={exportDatabase} disabled={savedPrompts.length === 0} className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 disabled:opacity-50 text-sm">
                                        <Icon name="Download" size={16} /> {t.database.export}
                                    </button>
                                    <label className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 cursor-pointer text-sm">
                                        <Icon name="Upload" size={16} /> {t.database.import}
                                        <input type="file" accept=".json" onChange={importDatabase} className="hidden" />
                                    </label>
                                </div>

                                {/* Prompts List */}
                                <div className="flex-1 overflow-y-auto space-y-2">
                                    {savedPrompts.length === 0 ? (
                                        <div className="text-center text-slate-500 py-8">{t.database.noPrompts}</div>
                                    ) : (
                                        savedPrompts.map(prompt => (
                                            <div key={prompt.id} className="bg-slate-700/50 p-3 rounded-lg border border-slate-600">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div>
                                                        <div className="text-white font-medium">{prompt.name}</div>
                                                        <div className="text-xs text-slate-400">{new Date(prompt.updatedAt).toLocaleDateString()}</div>
                                                    </div>
                                                    <div className="flex gap-1">
                                                        <button onClick={() => loadPrompt(prompt)} className="p-1.5 bg-green-500/20 text-green-400 rounded hover:bg-green-500/30" title={t.database.load}>
                                                            <Icon name="FolderOpen" size={14} />
                                                        </button>
                                                        <button onClick={() => editPrompt(prompt)} className="p-1.5 bg-blue-500/20 text-blue-400 rounded hover:bg-blue-500/30" title={t.database.edit}>
                                                            <Icon name="Edit3" size={14} />
                                                        </button>
                                                        <button onClick={() => duplicatePrompt(prompt)} className="p-1.5 bg-amber-500/20 text-amber-400 rounded hover:bg-amber-500/30" title={t.database.duplicate}>
                                                            <Icon name="Copy" size={14} />
                                                        </button>
                                                        <button onClick={() => deletePrompt(prompt.id)} className="p-1.5 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30" title={t.database.delete}>
                                                            <Icon name="Trash2" size={14} />
                                                        </button>
                                                    </div>
                                                </div>
                                                <div className="text-xs text-slate-400 truncate">{prompt.fields?.task?.substring(0, 80)}...</div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <div className="flex items-center gap-4">
                                <a href="../../index.html" className="flex items-center gap-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-colors">
                                    <Icon name="ArrowLeft" size={18} />
                                    <span className="hidden sm:inline">{t.backToHub}</span>
                                </a>
                                <div>
                                    <div className="flex items-center gap-2">
                                        <Icon name="Sparkles" size={24} className="text-amber-400" />
                                        <h1 className="text-2xl font-bold text-white">{t.title}</h1>
                                    </div>
                                    <p className="text-slate-400 text-sm">{t.subtitle}</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-2">
                                {/* Share Button */}
                                <button onClick={openShareModal} disabled={!formattedPrompt} className="flex items-center gap-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white hover:bg-slate-700 disabled:opacity-50" title={t.share.title}>
                                    <Icon name="Share2" size={16} className="text-green-400" />
                                </button>

                                {/* Import Button */}
                                <button onClick={() => setShowImportModal(true)} className="flex items-center gap-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white hover:bg-slate-700" title={t.share.importTitle}>
                                    <Icon name="Download" size={16} className="text-blue-400" />
                                </button>

                                {/* Database Button */}
                                <button onClick={() => setShowDatabase(true)} className="flex items-center gap-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white hover:bg-slate-700">
                                    <Icon name="Database" size={16} className="text-amber-400" />
                                    <span className="text-sm">{savedPrompts.length}</span>
                                </button>

                                {/* Language Selector */}
                                <div className="relative">
                                    <button onClick={() => setShowLangDropdown(!showLangDropdown)} className="flex items-center gap-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white hover:bg-slate-700">
                                        <Icon name="Globe" size={16} className="text-slate-400" />
                                        <span className="text-lg">{selectedLang?.flag}</span>
                                        <Icon name="ChevronDown" size={14} className={`transition-transform ${showLangDropdown ? 'rotate-180' : ''}`} />
                                    </button>
                                    {showLangDropdown && (
                                        <div className="absolute top-full right-0 mt-1 w-40 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-30">
                                            {languages.map(l => (
                                                <button key={l.code} onClick={() => { setLang(l.code); setShowLangDropdown(false); }}
                                                    className={`w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 text-left ${lang === l.code ? 'bg-slate-700' : ''}`}>
                                                    <span className="text-lg">{l.flag}</span>
                                                    <span className="text-sm text-white">{l.name}</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="grid lg:grid-cols-5 gap-6">
                            {/* Input Panel */}
                            <div className="lg:col-span-2 space-y-4">
                                {/* Template & Target */}
                                <div className="flex gap-3">
                                    <div className="relative flex-1">
                                        <button onClick={() => setShowTemplates(!showTemplates)} className="w-full flex items-center justify-between gap-2 px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white">
                                            <div className="flex items-center gap-2">
                                                <Icon name={TemplateIcon} size={16} className="text-amber-400" />
                                                <span className="text-sm">{selectedTemplate?.name}</span>
                                            </div>
                                            <Icon name="ChevronDown" size={16} className={`transition-transform ${showTemplates ? 'rotate-180' : ''}`} />
                                        </button>
                                        {showTemplates && (
                                            <div className="absolute top-full left-0 right-0 mt-1 bg-slate-800 border border-slate-700 rounded-lg overflow-hidden z-10 shadow-xl">
                                                {Object.entries(t.templates).map(([key, val]) => (
                                                    <button key={key} onClick={() => { setTemplate(key); setShowTemplates(false); }}
                                                        className={`w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-700 ${template === key ? 'bg-slate-700' : ''}`}>
                                                        <Icon name={templateIcons[key]} size={16} className="text-amber-400" />
                                                        <div className="text-left">
                                                            <div className="text-white text-sm">{val.name}</div>
                                                            <div className="text-slate-400 text-xs">{val.desc}</div>
                                                        </div>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex bg-slate-800 border border-slate-700 rounded-lg p-1">
                                        {aiTargets.map(ai => (
                                            <button key={ai.id} onClick={() => setTarget(ai.id)}
                                                className={`px-2 py-1.5 rounded-md text-xs font-medium transition-colors ${target === ai.id ? 'bg-amber-500 text-slate-900' : 'text-slate-400 hover:text-white'}`}>
                                                {ai.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Input Fields */}
                                <div className="space-y-3">
                                    {[
                                        { key: 'role', field: t.fields.role },
                                        { key: 'task', field: t.fields.task, required: true },
                                        { key: 'context', field: t.fields.context },
                                        { key: 'constraints', field: selectedMethods.includes('risen') ? t.fields.steps : t.fields.constraints },
                                        { key: 'outputFormat', field: selectedMethods.includes('risen') ? t.fields.expectations : t.fields.outputFormat },
                                        { key: 'examples', field: selectedMethods.includes('fewshot') ? t.fields.fewshot : t.fields.examples },
                                    ].map(({ key, field, required }) => (
                                        <div key={key}>
                                            <label className="block text-sm font-medium text-slate-300 mb-1.5">
                                                {field.label} {required && <span className="text-amber-400">{t.required}</span>}
                                            </label>
                                            {key === 'role' ? (
                                                <input type="text" value={fields[key]} onChange={e => updateField(key, e.target.value)} placeholder={field.placeholder}
                                                    className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 text-sm" />
                                            ) : (
                                                <textarea value={fields[key]} onChange={e => updateField(key, e.target.value)} placeholder={field.placeholder} rows={2}
                                                    className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 resize-none text-sm" />
                                            )}
                                        </div>
                                    ))}
                                </div>

                                {/* Action Buttons */}
                                <div className="flex gap-2">
                                    <button onClick={resetForm} className="flex items-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 text-sm">
                                        <Icon name="Plus" size={16} /> {t.newPrompt}
                                    </button>
                                    <button onClick={() => { setEditingId(null); setPromptName(''); setSaveModalOpen(true); }} disabled={!formattedPrompt}
                                        className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 disabled:opacity-50 text-sm font-medium">
                                        <Icon name="Save" size={16} /> {t.database.save}
                                    </button>
                                </div>
                            </div>

                            {/* Methods Panel */}
                            <div className="lg:col-span-1">
                                <h3 className="text-sm font-medium text-slate-300 mb-3">{t.methods.title}</h3>
                                <div className="space-y-2">
                                    {Object.entries(t.methods).filter(([k]) => !['title', 'active'].includes(k)).map(([key, method]) => (
                                        <div key={key} className="relative">
                                            <button onClick={() => toggleMethod(key)} onMouseEnter={() => setShowMethodInfo(key)} onMouseLeave={() => setShowMethodInfo(null)}
                                                className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg border transition-all text-left ${
                                                    selectedMethods.includes(key) ? 'bg-amber-500/20 border-amber-500/50 text-amber-300' : 'bg-slate-800/50 border-slate-700 text-slate-300 hover:border-slate-600'
                                                }`}>
                                                <Icon name={methodIcons[key]} size={16} className={`flex-shrink-0 ${selectedMethods.includes(key) ? 'text-amber-400' : 'text-slate-500'}`} />
                                                <div className="min-w-0">
                                                    <div className="text-xs font-medium truncate">{method.name}</div>
                                                    <div className="text-xs text-slate-500 truncate">{method.citation}</div>
                                                </div>
                                            </button>
                                            {showMethodInfo === key && (
                                                <div className="absolute left-full ml-2 top-0 w-48 p-3 bg-slate-800 border border-slate-600 rounded-lg shadow-xl z-20">
                                                    <div className="text-xs font-medium text-white mb-1">{method.name}</div>
                                                    <div className="text-xs text-amber-400">{method.tip}</div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                {selectedMethods.length > 0 && (
                                    <div className="mt-3 p-2 bg-slate-800/50 rounded-lg border border-slate-700">
                                        <div className="text-xs text-slate-400"><span className="text-amber-400">{selectedMethods.length}</span> {t.methods.active}</div>
                                    </div>
                                )}
                            </div>

                            {/* Preview Panel */}
                            <div className="lg:col-span-2 flex flex-col">
                                <div className="flex items-center justify-between mb-3">
                                    <h2 className="text-sm font-medium text-slate-300">{t.preview}</h2>
                                    <button onClick={copyToClipboard} disabled={!formattedPrompt}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors ${formattedPrompt ? 'bg-amber-500 text-slate-900 hover:bg-amber-400' : 'bg-slate-700 text-slate-500 cursor-not-allowed'}`}>
                                        <Icon name={copied ? "Check" : "Copy"} size={16} />
                                        {copied ? t.copied : t.copy}
                                    </button>
                                </div>
                                <div className="flex-1 bg-slate-800/50 border border-slate-700 rounded-lg p-4 overflow-auto min-h-[400px]">
                                    {formattedPrompt ? (
                                        <pre className="text-slate-200 text-sm whitespace-pre-wrap font-mono leading-relaxed">{formattedPrompt}</pre>
                                    ) : (
                                        <div className="h-full flex items-center justify-center text-slate-500 text-sm text-center px-4">{t.placeholder}</div>
                                    )}
                                </div>
                                {formattedPrompt && (
                                    <div className="mt-3 flex justify-between text-xs text-slate-500">
                                        <span>{t.optimizedFor} {aiTargets.find(a => a.id === target)?.name}</span>
                                        <span>{formattedPrompt.length} {t.chars}</span>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="mt-6 p-4 bg-slate-800/30 border border-slate-700/50 rounded-lg">
                            <div className="text-xs text-slate-500 text-center">{t.footer}</div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
