<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdHub Youtube Downloader</title>
    <link rel="stylesheet" href="styles.css">
    <script>
    // Load JSZip with fallback
    (function() {
        console.log('[AdHub] Loading JSZip...');
        const sources = [
            'jszip.min.js',
            'https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js',
            'https://unpkg.com/jszip@3.10.1/dist/jszip.min.js'
        ];
        let currentIndex = 0;
        function tryLoadJSZip() {
            if (currentIndex >= sources.length) {
                console.error('[AdHub] Failed to load JSZip');
                return;
            }
            const script = document.createElement('script');
            script.src = sources[currentIndex];
            script.onerror = function() {
                currentIndex++;
                tryLoadJSZip();
            };
            script.onload = function() {
                console.log('[AdHub] JSZip loaded:', JSZip.version);
            };
            document.head.appendChild(script);
        }
        tryLoadJSZip();
    })();
    </script>
    <script defer src="script.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <a href="../../index.html" class="back-to-hub">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    <span>Hub</span>
                </a>
                <h1>AdHub Youtube Downloader</h1>
            </div>
            <div class="controls">
                <div class="extension-status-container">
                    <span id="extensionStatus" class="extension-status extension-status-checking"></span>
                    <span id="extensionStatusText" class="extension-status-text">Kontroluji plugin...</span>
                </div>
            </div>
        </header>

        <!-- Plugin Info Bar -->
        <div id="pluginInfoBar" class="plugin-info-bar" style="display: none;">
            <div class="plugin-info-content">
                <div class="plugin-info-item">
                    <span class="plugin-info-label">Verze pluginu:</span>
                    <span id="pluginVersion" class="plugin-info-value">-</span>
                </div>
                <div class="plugin-info-item">
                    <span class="plugin-info-label">Commit:</span>
                    <span id="pluginCommit" class="plugin-info-value">-</span>
                </div>
            </div>
        </div>

        <!-- Instalacni sekce -->
        <div id="installSection" class="install-section">
            <div class="install-hero">
                <div class="hero-icon">
                    <svg width="80" height="80" viewBox="0 0 128 128">
                        <defs>
                            <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6"/>
                                <stop offset="100%" style="stop-color:#7c3aed"/>
                            </linearGradient>
                        </defs>
                        <rect width="128" height="128" rx="20" fill="url(#grad)"/>
                        <path d="M64 30 L64 75 M44 55 L64 75 L84 55" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        <rect x="35" y="85" width="58" height="8" rx="4" fill="white"/>
                    </svg>
                </div>
                <h2>Nainstalujte AdHub Youtube Downloader</h2>
                <p class="hero-subtitle">Stahujte YouTube videa ve vsech formatech - MP4, MP3, WAV a dalsi</p>
            </div>

            <div class="install-options">
                <!-- Stazeni pluginu -->
                <div class="install-card install-card-primary">
                    <div class="install-card-header">
                        <span class="install-badge">Krok 1</span>
                        <h3>Stahni plugin</h3>
                    </div>
                    <p>Stahni plugin jako ZIP soubor primo z GitHub repositare.</p>

                    <!-- Commit info -->
                    <div class="commit-info" id="commitInfo">
                        <div class="commit-loading" id="commitLoading">
                            <div class="spinner-small"></div>
                            <span>Nacitam informace o verzi...</span>
                        </div>
                        <div class="commit-details" id="commitDetails" style="display: none;">
                            <div class="commit-row">
                                <span class="commit-label">Posledni commit:</span>
                                <code id="latestCommitId" class="commit-id">-</code>
                            </div>
                            <div class="commit-row">
                                <span class="commit-label">Datum:</span>
                                <span id="latestCommitDate">-</span>
                            </div>
                            <div class="commit-row">
                                <span class="commit-label">Zprava:</span>
                                <span id="latestCommitMessage" class="commit-message">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="install-actions">
                        <button class="btn btn-primary btn-large" id="downloadPluginBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Stahnout plugin (.zip)
                        </button>
                    </div>

                    <div class="download-progress" id="downloadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="downloadProgressFill"></div>
                        </div>
                        <span id="downloadProgressText">Generuji ZIP...</span>
                    </div>
                </div>

                <!-- GitHub odkaz -->
                <div class="install-card">
                    <h3>Alternativa: GitHub</h3>
                    <p>Muzete take stahnout plugin primo z GitHubu.</p>
                    <a href="https://github.com/Deerpfy/adhub/tree/main/projects/youtube-downloader/plugin"
                       target="_blank" class="btn btn-secondary">
                        Otevrit na GitHubu
                    </a>
                </div>
            </div>

            <!-- Kroky instalace -->
            <div class="install-steps-section">
                <h3>Jak nainstalovat plugin</h3>
                <div class="install-steps">
                    <div class="install-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Stahni a rozbal</h4>
                            <p>Klikni na tlacitko "Stahnout plugin" vyse. Pote rozbal stazeny ZIP soubor.</p>
                        </div>
                    </div>

                    <div class="install-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Otevri spravu rozsireni</h4>
                            <p>V prohlizeci zadej do adresniho radku:</p>
                            <div class="browser-urls">
                                <div class="browser-url">
                                    <span class="browser-name">Chrome:</span>
                                    <code class="url-code" onclick="copyToClipboard('chrome://extensions')">chrome://extensions</code>
                                    <button class="copy-btn" onclick="copyToClipboard('chrome://extensions')">Kopirovat</button>
                                </div>
                                <div class="browser-url">
                                    <span class="browser-name">Edge:</span>
                                    <code class="url-code" onclick="copyToClipboard('edge://extensions')">edge://extensions</code>
                                    <button class="copy-btn" onclick="copyToClipboard('edge://extensions')">Kopirovat</button>
                                </div>
                                <div class="browser-url">
                                    <span class="browser-name">Brave:</span>
                                    <code class="url-code" onclick="copyToClipboard('brave://extensions')">brave://extensions</code>
                                    <button class="copy-btn" onclick="copyToClipboard('brave://extensions')">Kopirovat</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="install-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Zapni vyvojarsky rezim</h4>
                            <p>V pravem hornim rohu stranky prepni prepinac "Vyvojarsky rezim" (Developer mode).</p>
                        </div>
                    </div>

                    <div class="install-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Nacti plugin</h4>
                            <p>Klikni na "Nacist rozbalene" (Load unpacked) a vyber rozbalenou slozku.</p>
                        </div>
                    </div>

                    <div class="install-step install-step-success">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Hotovo!</h4>
                            <p>Nyni muzes stahovat videa primo z YouTube! Jdi na libovolne YouTube video a klikni na tlacitko "Stahnout" pod videem.</p>
                            <button id="goToYoutubeBtn" class="btn btn-success">Jit na YouTube</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="install-features">
                <h3>Co plugin umi</h3>
                <div class="features-grid">
                    <div class="feature-item">
                        <span class="feature-icon">MP4</span>
                        <h4>Video</h4>
                        <p>MP4, WebM v ruznych kvalitach</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">MP3</span>
                        <h4>Audio</h4>
                        <p>M4A, WebM audio formaty</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">YT</span>
                        <h4>Tlacitko na YouTube</h4>
                        <p>Stahuj primo z YouTube stranky</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">DBG</span>
                        <h4>Debugovatelne</h4>
                        <p>Kazdy krok je logovany</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sekce pro stahovani - zobrazi se kdyz je plugin aktivni -->
        <div id="downloadSection" class="download-section" style="display: none;">
            <div class="main-content">
                <div class="download-area">
                    <div class="success-banner">
                        <span class="success-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                                <path d="M22 4L12 14.01l-3-3"/>
                            </svg>
                        </span>
                        <div>
                            <strong>Plugin je aktivni!</strong>
                            <p>Pro stahovani videi jdi primo na YouTube a klikni na tlacitko "Stahnout" pod videem.</p>
                        </div>
                    </div>

                    <div class="input-card">
                        <h2>Nebo zadej URL YouTube videa</h2>
                        <form id="videoForm">
                            <div class="input-group">
                                <label for="videoUrl">YouTube URL nebo Video ID:</label>
                                <input
                                    type="text"
                                    id="videoUrl"
                                    placeholder="https://www.youtube.com/watch?v=... nebo VIDEO_ID"
                                    required
                                >
                            </div>

                            <button type="submit" class="btn btn-primary" id="fetchInfoBtn">
                                Ziskat informace
                            </button>
                        </form>
                    </div>

                    <div id="videoInfoCard" class="video-info-card" style="display: none;">
                        <div class="video-thumbnail">
                            <img id="videoThumbnail" src="" alt="Video thumbnail">
                        </div>
                        <div class="video-details">
                            <h3 id="videoTitle"></h3>
                            <div class="video-meta">
                                <span id="videoUploader"></span>
                                <span id="videoDuration"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Formaty ke stazeni -->
                    <div id="formatsCard" class="formats-card" style="display: none;">
                        <h3>Dostupne formaty ke stazeni</h3>

                        <div class="formats-section" id="combinedFormatsSection" style="display: none;">
                            <h4>Video (s audiem)</h4>
                            <div id="combinedFormatsList" class="formats-list"></div>
                        </div>

                        <div class="formats-section" id="videoFormatsSection" style="display: none;">
                            <h4>Video (bez audia)</h4>
                            <div id="videoFormatsList" class="formats-list"></div>
                        </div>

                        <div class="formats-section" id="audioFormatsSection" style="display: none;">
                            <h4>Audio</h4>
                            <div id="audioFormatsList" class="formats-list"></div>
                        </div>
                    </div>
                </div>

                <div class="info-sidebar">
                    <!-- Stazeni pluginu -->
                    <div class="plugin-download-card">
                        <h2>Stahnout plugin</h2>
                        <p>Stahni si plugin pro prohlizec a pouzivej tlacitko "Stahnout" primo na YouTube.</p>
                        <div class="commit-info-small" id="commitInfoSmall">
                            <span>Verze: <code id="commitIdSmall">-</code></span>
                        </div>
                        <button class="btn btn-primary btn-full" id="downloadPluginBtnSmall">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Stahnout (.zip)
                        </button>
                        <div class="download-progress" id="downloadProgressSmall" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="downloadProgressFillSmall"></div>
                            </div>
                            <span id="downloadProgressTextSmall">Generuji ZIP...</span>
                        </div>
                    </div>

                    <div class="downloads-history">
                        <h2>Historie</h2>
                        <p class="history-notice">Historie se automaticky smaze po 48 hodinach</p>
                        <div id="downloadsList" class="downloads-list">
                            <p class="empty-state-text">Zatim zadne stazene soubory</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notifikace -->
    <div id="toastContainer" class="toast-container"></div>

</body>
</html>
